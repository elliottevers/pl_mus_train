{"version":3,"file":"trainer.js","sourceRoot":"","sources":["../../src/train/trainer.ts"],"names":[],"mappings":";;AAEA,8CAA2C;AAO3C,qCAAkC;AAMlC,IAAiB,OAAO,CAoXvB;AApXD,WAAiB,OAAO;IAEpB,IAAO,gBAAgB,GAAG,iBAAO,CAAC,gBAAgB,CAAC;IAUnD,IAAO,oBAAoB,GAAG,iBAAO,CAAC,oBAAoB,CAAC;IAG3D,IAAO,uBAAuB,GAAG,iBAAO,CAAC,uBAAuB,CAAC;IAUjE;QAkCI,iBACI,MAAoB,EACpB,kBAAoC,EACpC,SAAoB,EACpB,YAAmB,EACnB,gBAAuB,EACvB,IAAU,EACV,QAAmB,EACnB,SAAoB,EACpB,WAAqB;YAblB,gBAAW,GAAY,KAAK,CAAC;YAE7B,SAAI,GAAY,KAAK,CAAC;YAazB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACrB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;YACjC,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;YACzC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YAC7C,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3B,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;YAE/B,IAAI,CAAC,kBAAkB,GAAG,YAAY,CAAC,SAAS,EAAE,CAAC;YAEnD,IAAI,CAAC,qBAAqB,GAAG,oBAAoB,CAAC,kBAAkB,CAChE,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,QAAQ,CAChB,CAAC;YAEF,IAAI,CAAC,kBAAkB,GAAG,IAAI,gBAAgB,CAC1C,uBAAuB,CAAC,gCAAgC,CACpD,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,QAAQ,CAChB,CACJ,CAAC;YAEF,IAAI,CAAC,MAAM,CAAC,gBAAgB,CACxB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,QAAQ,CAChB,CAAC;YAEF,IAAI,CAAC,MAAM,CAAC,gBAAgB,CACxB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,QAAQ,CACnD,CAAC;YAEF,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,6BAA6B,CAClE,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,QAAQ,CAChB,CAAC;YAEF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAClD,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,YAAY,CACpB,CAAC;YAEF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,uBAAuB,CACtD,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,kBAAkB,CAC1B,CAAC;YAEF,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAC5B,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,gBAAgB,EACrB,IAAI,CAAC,YAAY,CACpB,CAAC;YAEF,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAC1C,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,YAAY,CACpB,CAAC;QACN,CAAC;QAEM,8BAAY,GAAnB;YACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACnB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAA;aACtB;QACL,CAAC;QAEM,+BAAa,GAApB;YACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBAEnB,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;oBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;iBACvB;gBAED,IAAI,CAAC,MAAM,CAAC,MAAM,CACd,IAAI,CAAC,qBAAqB,EAC1B,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,eAAe,CACvB,CAAA;aACJ;QACL,CAAC;QAEM,yBAAO,GAAd;YACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACnB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;aAChE;QACL,CAAC;QAEM,uBAAK,GAAZ;YACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACnB,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAA;aAC9D;QACL,CAAC;QAEO,yBAAO,GAAf;YACI,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;gBACzB,IAAI,CAAC,eAAe,EAAE,CAAA;aACzB;iBAAM,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE;gBAClC,IAAI,CAAC,iBAAiB,EAAE,CAAA;aAC3B;iBAAM;gBACH,MAAM,iCAAiC,CAAA;aAC1C;QACL,CAAC;QAEM,0BAAQ,GAAf;YACI,IAAI,CAAC,OAAO,EAAE,CAAC;QACnB,CAAC;QAEO,2BAAS,GAAjB;YACI,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACnB,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAE3D,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;aAC/D;QACL,CAAC;QAEO,iCAAe,GAAvB;YAEI,IAAI,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;YAEvD,IAAI,cAAc,CAAC,IAAI,EAAE;gBAErB,IAAI,CAAC,SAAS,EAAE,CAAC;gBAEjB,OAAM;aACT;YAED,IAAI,CAAC,YAAY,EAAE,CAAA;QACvB,CAAC;QAEO,mCAAiB,GAAzB;YAEI,kCAAkC;YAElC,IAAI,cAAc,GAAG,IAAI,CAAC,YAA6B,CAAC;YAExD,IAAI,cAAc,GAAY,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEtE,IAAI,cAAc,EAAE;gBAChB,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;gBAElC,IAAI,CAAC,uBAAuB,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEpD,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,CAAC;gBAEpC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,CAAC;gBAE7D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;gBAEzE,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC;gBAEvC,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,0BAA0B,CAAC,OAAO,EAAE,CAAC;gBAEnE,IAAI,CAAC,YAAY,EAAE,CAAC;gBAEpB,OAAM;aACT;YAED,IAAI,kBAAkB,GAAG,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC;YAEhE,IAAI,kBAAkB,CAAC,IAAI,EAAE;gBAEzB,IAAI,eAAe,GAAG,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,CAAC;gBAE1D,IAAI,eAAe,CAAC,IAAI,EAAE;oBAEtB,IAAI,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;oBAEvD,IAAI,cAAc,CAAC,IAAI,EAAE;wBAErB,IAAI,CAAC,SAAS,EAAE,CAAC;wBAEjB,OAAM;qBACT;oBAED,IAAI,UAAU,GAAG,cAAc,CAAC,KAAK,CAAC;oBAEtC,IAAI,CAAC,uBAAuB,GAAG,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;oBAE5E,IAAI,4BAA4B,GAAG,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,CAAC;oBAEvE,IAAI,CAAC,cAAc,GAAG,4BAA4B,CAAC,KAAK,CAAC;oBAEzD,IAAI,+BAA+B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;oBAEpF,IAAI,CAAC,iBAAiB,GAAG,+BAA+B,CAAC,KAAK,CAAC;oBAE/D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;oBAEzE,IAAI,CAAC,YAAY,EAAE,CAAC;oBAEpB,OAAM;iBACT;gBAED,IAAI,CAAC,cAAc,GAAG,eAAe,CAAC,KAAK,CAAC;gBAE5C,IAAI,8BAA8B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;gBAEnF,IAAI,CAAC,iBAAiB,GAAG,8BAA8B,CAAC,KAAK,CAAC;gBAE9D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;gBAEzE,IAAI,CAAC,aAAa,EAAE,CAAC;gBAErB,OAAM;aACT;YAED,IAAI,CAAC,iBAAiB,GAAG,kBAAkB,CAAC,KAAK,CAAC;YAElD,IAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC;QAEO,+BAAa,GAArB;YACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACnB,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;aAC7G;QACL,CAAC;QAEO,+BAAa,GAArB;YACI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBAEnB,IAAI,CAAC,SAAS,CAAC,aAAa,CACxB,IAAI,CAAC,eAAe,CAAC,KAAK,EAC1B,IAAI,CAAC,IAAI,CACZ,CAAC;gBAEF,IAAI,CAAC,SAAS,CAAC,aAAa,CACxB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,iBAAiB,EACtB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,QAAQ,CAChB,CAAA;aACJ;QACL,CAAC;QAED,8BAAY,GAAZ;YACI,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAExF,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;YAEtD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC;YAE5D,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,CAAC;YAE1D,IAAI,CAAC,aAAa,EAAE,CAAA;QACxB,CAAC;QAED,8BAAY,GAAZ,UAAa,gBAA0C;YAEnD,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAE1B,IAAI,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,gBAAgB,EAAE;gBAClD,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAA;aAClC;YAED,IAAI,IAAI,CAAC,mBAAmB,EAAE;gBAC1B,oBAAoB;gBACpB,OAAM;aACT;YAED,IAAI,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,IAAI,CAAC,iBAAiB,CAAC,EAAE;gBAE3E,IAAI,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,sBAAsB,CAC3D,gBAAgB,EAChB,IAAI,CAAC,iBAAiB,CACzB,CAAC;gBAEF,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,yBAAyB,CAC9D,mBAAmB,EACnB,IAAI,CAAC,kBAAkB,EACvB,IAAI,CAAC,qBAAqB,EAC1B,IAAI,CAAC,SAAS,CACjB,CAAC;gBAEF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAC5C,mBAAmB,EACnB,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,qBAAqB,CAC7B,CAAC;gBAEF,IAAI,CAAC,MAAM,CAAC,iBAAiB,CACzB,mBAAmB,EACnB,IAAI,CAAC,SAAS,CAAC,0BAA0B,CACrC,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CACjD,CACJ,CAAC;gBAEF,IAAI,CAAC,OAAO,EAAE,CAAC;gBAEf,IAAI,CAAC,aAAa,EAAE,CAAC;aACxB;QACL,CAAC;QACL,cAAC;IAAD,CAAC,AA1VD,IA0VC;IA1VY,eAAO,UA0VnB,CAAA;AACL,CAAC,EApXgB,OAAO,GAAP,eAAO,KAAP,eAAO,QAoXvB","sourcesContent":["import {note, note as n} from \"../note/note\";\nimport TreeModel = require(\"tree-model\");\nimport {history} from \"../history/history\";\nimport {target} from \"../target/target\";\nimport {segment} from \"../segment/segment\";\nimport {parse} from \"../parse/parse\";\nimport {message} from \"../message/messenger\";\nimport {song} from \"../song/song\";\nimport {clip} from \"../clip/clip\";\nimport {iterate} from \"./iterate\";\nimport {window} from \"../render/window\";\nimport {track} from \"../track/track\";\nimport {user_input} from \"../control/user_input\";\nimport {trainable} from \"../algorithm/trainable\";\n\nexport namespace trainer {\n\n    import HistoryUserInput = history.HistoryUserInput;\n    import TargetIterator = target.TargetIterator;\n    import Segment = segment.Segment;\n    import Subtarget = target.Subtarget;\n    import Target = target.Target;\n    import Messenger = message.Messenger;\n    import Clip = clip.Clip;\n    import SubtargetIterator = target.SubtargetIterator;\n    import StructParse = parse.StructParse;\n    import MatrixIterator = iterate.MatrixIterator;\n    import IteratorTrainFactory = iterate.IteratorTrainFactory;\n    import Note = note.Note;\n    import Track = track.Track;\n    import FactoryMatrixObjectives = iterate.FactoryMatrixObjectives;\n    import UserInputHandler = user_input.UserInputHandler;\n    import Song = song.Song;\n    import MatrixWindow = window.MatrixWindow;\n    import Trainable = trainable.Trainable;\n\n    export type StructTargets = TargetIterator[][];\n\n    export type StructTrain = StructParse | StructTargets;\n\n    export class Trainer {\n\n        private window: MatrixWindow;\n        public trainable: Trainable; // TODO: type\n        public clip_user_input: Clip;\n\n        private notes_target_track: TreeModel.Node<Note>[];\n        private track_target: Track;\n        private track_user_input: Track;\n        private song: Song;\n        private segments: Segment[];\n        private messenger: Messenger;\n\n        public history_user_input: HistoryUserInput;\n        public struct_train: StructTrain;\n\n        private counter_user_input: number;\n        private limit_user_input: number;\n        private limit_input_reached: boolean;\n\n        public segment_current: Segment;\n        public target_current: Target;\n        private subtarget_current: Subtarget;\n\n        public iterator_matrix_train: MatrixIterator;\n        private iterator_target_current: TargetIterator;\n        private iterator_subtarget_current: SubtargetIterator;\n\n        private user_input_handler: UserInputHandler;\n\n        public virtualized: boolean = false;\n\n        public done: boolean = false;\n\n        constructor(\n            window: MatrixWindow,\n            user_input_handler: UserInputHandler,\n            trainable: Trainable,\n            track_target: Track,\n            track_user_input: Track,\n            song: Song,\n            segments: Segment[],\n            messenger: Messenger,\n            virtualized?: boolean\n        ) {\n            this.window = window;\n            this.trainable = trainable;\n            this.track_target = track_target;\n            this.track_user_input = track_user_input;\n            this.song = song;\n            this.user_input_handler = user_input_handler;\n            this.segments = segments;\n            this.messenger = messenger;\n            this.virtualized = virtualized;\n\n            this.notes_target_track = track_target.get_notes();\n\n            this.iterator_matrix_train = IteratorTrainFactory.get_iterator_train(\n                this.trainable,\n                this.segments\n            );\n\n            this.history_user_input = new HistoryUserInput(\n                FactoryMatrixObjectives.create_matrix_user_input_history(\n                    this.trainable,\n                    this.segments\n                )\n            );\n\n            this.window.initialize_clips(\n                this.trainable,\n                this.segments\n            );\n\n            this.window.set_length_beats(\n                this.segments[this.segments.length - 1].beat_end\n            );\n\n            this.history_user_input = this.trainable.preprocess_history_user_input(\n                this.history_user_input,\n                this.segments\n            );\n\n            this.struct_train = this.trainable.create_struct_train(\n                this.window,\n                this.segments,\n                this.track_target,\n                this.user_input_handler,\n                this.struct_train\n            );\n\n            this.struct_train = this.trainable.preprocess_struct_train(\n                this.struct_train,\n                this.segments,\n                this.notes_target_track\n            );\n\n            this.trainable.initialize_tracks(\n                this.segments,\n                this.track_target,\n                this.track_user_input,\n                this.struct_train\n            );\n\n            this.window = this.trainable.initialize_render(\n                this.window,\n                this.segments,\n                this.notes_target_track,\n                this.struct_train\n            );\n        }\n\n        public clear_window() {\n            if (!this.virtualized) {\n                this.window.clear()\n            }\n        }\n\n        public render_window() {\n            if (!this.virtualized) {\n\n                if (!this.done) {\n                    this.window.clear();\n                }\n\n                this.window.render(\n                    this.iterator_matrix_train,\n                    this.trainable,\n                    this.struct_train,\n                    this.segment_current\n                )\n            }\n        }\n\n        public unpause() {\n            if (!this.virtualized) {\n                this.trainable.unpause(this.song, this.segment_current.scene)\n            }\n        }\n\n        public pause() {\n            if (!this.virtualized) {\n                this.trainable.pause(this.song, this.segment_current.scene)\n            }\n        }\n\n        private advance() {\n            if (this.trainable.b_parsed) {\n                this.advance_segment()\n            } else if (this.trainable.b_targeted) {\n                this.advance_subtarget()\n            } else {\n                throw 'cannot determine how to advance'\n            }\n        }\n\n        public commence() {\n            this.advance();\n        }\n\n        private shut_down() {\n            this.done = true;\n            if (!this.virtualized) {\n                this.trainable.terminate(this.struct_train, this.segments);\n\n                this.trainable.pause(this.song, this.segment_current.scene);\n            }\n        }\n\n        private advance_segment() {\n\n            let obj_next_coord = this.iterator_matrix_train.next();\n\n            if (obj_next_coord.done) {\n\n                this.shut_down();\n\n                return\n            }\n\n            this.next_segment()\n        }\n\n        private advance_subtarget() {\n\n            // let logger = new Logger('max');\n\n            let matrix_targets = this.struct_train as StructTargets;\n\n            let have_not_begun: boolean = (!this.iterator_matrix_train.b_started);\n\n            if (have_not_begun) {\n                this.iterator_matrix_train.next();\n\n                this.iterator_target_current = matrix_targets[0][0];\n\n                this.iterator_target_current.next();\n\n                this.target_current = this.iterator_target_current.current();\n\n                this.iterator_subtarget_current = this.target_current.iterator_subtarget;\n\n                this.iterator_subtarget_current.next();\n\n                this.subtarget_current = this.iterator_subtarget_current.current();\n\n                this.next_segment();\n\n                return\n            }\n\n            let obj_next_subtarget = this.iterator_subtarget_current.next();\n\n            if (obj_next_subtarget.done) {\n\n                let obj_next_target = this.iterator_target_current.next();\n\n                if (obj_next_target.done) {\n\n                    let obj_next_coord = this.iterator_matrix_train.next();\n\n                    if (obj_next_coord.done) {\n\n                        this.shut_down();\n\n                        return\n                    }\n\n                    let coord_next = obj_next_coord.value;\n\n                    this.iterator_target_current = matrix_targets[coord_next[0]][coord_next[1]];\n\n                    let obj_next_target_twice_nested = this.iterator_target_current.next();\n\n                    this.target_current = obj_next_target_twice_nested.value;\n\n                    let obj_next_subtarget_twice_nested = this.target_current.iterator_subtarget.next();\n\n                    this.subtarget_current = obj_next_subtarget_twice_nested.value;\n\n                    this.iterator_subtarget_current = this.target_current.iterator_subtarget;\n\n                    this.next_segment();\n\n                    return\n                }\n\n                this.target_current = obj_next_target.value;\n\n                let obj_next_subtarget_once_nested = this.target_current.iterator_subtarget.next();\n\n                this.subtarget_current = obj_next_subtarget_once_nested.value;\n\n                this.iterator_subtarget_current = this.target_current.iterator_subtarget;\n\n                this.stream_bounds();\n\n                return\n            }\n\n            this.subtarget_current = obj_next_subtarget.value;\n\n            this.stream_bounds();\n        }\n\n        private stream_bounds() {\n            if (!this.virtualized) {\n                this.trainable.stream_bounds(this.messenger, this.subtarget_current, this.segment_current, this.segments);\n            }\n        }\n\n        private advance_scene() {\n            if (!this.virtualized) {\n\n                this.trainable.advance_scene(\n                    this.segment_current.scene,\n                    this.song\n                );\n\n                this.trainable.stream_bounds(\n                    this.messenger,\n                    this.subtarget_current,\n                    this.segment_current,\n                    this.segments\n                )\n            }\n        }\n\n        next_segment() {\n            this.segment_current = this.segments[this.iterator_matrix_train.get_coord_current()[1]];\n\n            this.segment_current.scene.set_path_deferlow('scene');\n\n            this.clip_user_input = this.segment_current.clip_user_input;\n\n            this.clip_user_input.set_path_deferlow('clip_user_input');\n\n            this.advance_scene()\n        }\n\n        accept_input(notes_input_user: TreeModel.Node<n.Note>[]) {\n\n            this.counter_user_input++;\n\n            if (this.counter_user_input >= this.limit_user_input) {\n                this.limit_input_reached = true\n            }\n\n            if (this.limit_input_reached) {\n                // completely ignore\n                return\n            }\n\n            if (this.trainable.warrants_advance(notes_input_user, this.subtarget_current)) {\n\n                let input_postprocessed = this.trainable.postprocess_user_input(\n                    notes_input_user,\n                    this.subtarget_current\n                );\n\n                this.history_user_input = this.trainable.update_history_user_input(\n                    input_postprocessed,\n                    this.history_user_input,\n                    this.iterator_matrix_train,\n                    this.trainable\n                );\n\n                this.struct_train = this.trainable.update_struct(\n                    input_postprocessed,\n                    this.struct_train,\n                    this.trainable,\n                    this.iterator_matrix_train\n                );\n\n                this.window.add_notes_to_clip(\n                    input_postprocessed,\n                    this.trainable.coord_to_index_clip_render(\n                        this.iterator_matrix_train.get_coord_current()\n                    )\n                );\n\n                this.advance();\n\n                this.render_window();\n            }\n        }\n    }\n}"]}