{"version":3,"file":"cli.js","sourceRoot":"","sources":["../../src/cli/cli.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAEA,IAAiB,GAAG,CAgOnB;AAhOD,WAAiB,GAAG;IAGhB;QAQI,oBAAY,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS;YAC7C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACnB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;YACvB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC/B,CAAC;QAED,gCAAgC;QACzB,6BAAQ,GAAf;YACI,OAAO,IAAI,CAAC,oBAAoB,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC;QAClD,CAAC;QAEM,yCAAoB,GAA3B;YACI,IAAI,gBAAgB,GAAa,EAAE,CAAC;YAEpC,QAAQ;YACR,KAAiB,UAAU,EAAV,KAAA,IAAI,CAAC,KAAK,EAAV,cAAU,EAAV,IAAU,EAAE;gBAAxB,IAAI,IAAI,SAAA;gBACT,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE;oBACf,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;iBACnC;aACJ;YAED,UAAU;YACV,KAAmB,UAAY,EAAZ,KAAA,IAAI,CAAC,OAAO,EAAZ,cAAY,EAAZ,IAAY,EAAE;gBAA5B,IAAI,MAAM,SAAA;gBACX,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE;oBACjB,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;iBACrC;aACJ;YAED,OAAO;YACP,KAAgB,UAAS,EAAT,KAAA,IAAI,CAAC,IAAI,EAAT,cAAS,EAAT,IAAS,EAAE;gBAAtB,IAAI,GAAG,SAAA;gBACR,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE;oBACd,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;iBAClC;aACJ;YAED,OAAO,gBAAgB,CAAC;QAC5B,CAAC;QAEM,qCAAgB,GAAvB;YACI,OAAO,IAAI,CAAC,IAAI,CAAC;QACrB,CAAC;QAEM,4BAAO,GAAd,UAAe,QAAQ;YACnB,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,UAAC,GAAG;gBACxB,OAAO,GAAG,CAAC,IAAI,KAAK,QAAQ,CAAC;YACjC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACV,CAAC;QAEM,4BAAO,GAAd,UAAe,QAAQ;YACnB,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,UAAC,GAAG;gBAC3B,OAAO,GAAG,CAAC,IAAI,KAAK,QAAQ,CAAC;YACjC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACV,CAAC;QAEM,6BAAQ,GAAf,UAAgB,SAAS;YACrB,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAC,IAAI;gBAC1B,OAAO,IAAI,CAAC,IAAI,KAAK,SAAS,CAAC;YACnC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACV,CAAC;QAEM,oCAAe,GAAtB;YACI,IAAI,YAAY,GAAW,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAEnD,IAAI,IAAI,GAAa,EAAE,CAAC;YAExB,KAAiB,UAAU,EAAV,KAAA,IAAI,CAAC,KAAK,EAAV,cAAU,EAAV,IAAU,EAAE;gBAAxB,IAAI,IAAI,SAAA;gBACT,IAAI,IAAI,CAAC,KAAK,EAAE,EAAE;oBACd,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;iBACnC;aACJ;YAED,UAAU;YACV,KAAmB,UAAY,EAAZ,KAAA,IAAI,CAAC,OAAO,EAAZ,cAAY,EAAZ,IAAY,EAAE;gBAA5B,IAAI,MAAM,SAAA;gBACX,IAAI,MAAM,CAAC,KAAK,EAAE,EAAE;oBAChB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC,CAAC;iBACrC;aACJ;YAED,OAAO;YACP,KAAgB,UAAS,EAAT,KAAA,IAAI,CAAC,IAAI,EAAT,cAAS,EAAT,IAAS,EAAE;gBAAtB,IAAI,GAAG,SAAA;gBACR,IAAI,GAAG,CAAC,KAAK,EAAE,EAAE;oBACb,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,CAAC;iBAClC;aACJ;YAED,OAAO,YAAY,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC/C,CAAC;QAEM,wBAAG,GAAV;YACI,IAAI,YAAY,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAC/C,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;gBACzB,MAAM,oBAAoB,GAAG,YAAY,CAAA;aAC5C;YACD,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9D,CAAC;QACL,iBAAC;IAAD,CAAC,AAzGD,IAyGC;IAzGY,cAAU,aAyGtB,CAAA;IAED;QAAA;QAuCA,CAAC;QAnCG,2CAAe,GAAf,UAAgB,GAAG;YACf,IAAI,IAAI,CAAC,kBAAkB,EAAE;gBACzB,OAAO,KAAK,GAAG,GAAG,GAAG,KAAK,CAAC;aAC9B;iBAAM;gBACH,OAAO,GAAG,CAAC;aACd;QACL,CAAC;QAED,6CAAiB,GAAjB,UAAkB,GAAG;YACjB,IAAI,IAAI,CAAC,oBAAoB,EAAE;gBAC3B,0CAA0C;gBAC1C,aAAa;gBACb,cAAc;gBACd,2CAA2C;gBAC3C,OAAO,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aAEvC;iBAAM;gBACH,OAAO,GAAG,CAAC;aACd;QACL,CAAC;QAED,uCAAW,GAAX,UAAY,GAAG;YACX,IAAI,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,oBAAoB,EAAE;gBACtD,0BAA0B;gBAC1B,MAAM,kCAAkC,CAAA;aAC3C;YACD,IAAI,IAAI,CAAC,kBAAkB,EAAE;gBACzB,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAA;aACnC;YACD,IAAI,IAAI,CAAC,oBAAoB,EAAE;gBAC3B,OAAO,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAA;aACrC;YAED,OAAO,GAAG,CAAC;QACf,CAAC;QACL,wBAAC;IAAD,CAAC,AAvCD,IAuCC;IAED;QAAyB,uBAAiB;QAItC,aAAY,IAAI,EAAE,kBAA4B,EAAE,oBAA8B;YAA9E,YACI,iBAAO,SAIV;YAHG,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,KAAI,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YAC7C,KAAI,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;;QACrD,CAAC;QAEM,iBAAG,GAAV,UAAW,GAAG;YACV,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACnB,CAAC;QAEM,2BAAa,GAApB;YACI,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QACrC,CAAC;QAED,2BAA2B;QAC3B,gEAAgE;QAChE,IAAI;QAEG,mBAAK,GAAZ;YACI,OAAO,IAAI,CAAC,GAAG,KAAK,IAAI,CAAA;QAC5B,CAAC;QACL,UAAC;IAAD,CAAC,AA1BD,CAAyB,iBAAiB,GA0BzC;IA1BY,OAAG,MA0Bf,CAAA;IAED;QAA0B,wBAAiB;QAIvC,cAAY,IAAI;YAAhB,YACI,iBAAO,SAEV;YADG,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;;QACrB,CAAC;QAEM,kBAAG,GAAV,UAAW,GAAG;YACV,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACnB,CAAC;QAEM,4BAAa,GAApB;YACI,OAAO,GAAG,GAAG,IAAI,CAAC,IAAI,CAAA;QAC1B,CAAC;QAEM,oBAAK,GAAZ;YACI,OAAO,IAAI,CAAC,GAAG,CAAA;QACnB,CAAC;QACL,WAAC;IAAD,CAAC,AApBD,CAA0B,iBAAiB,GAoB1C;IApBY,QAAI,OAoBhB,CAAA;IAED;QAA4B,0BAAiB;QAIzC,gBAAY,IAAI,EAAE,kBAA4B,EAAE,oBAA8B;YAA9E,YACI,iBAAO,SAIV;YAHG,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,KAAI,CAAC,kBAAkB,GAAG,kBAAkB,CAAC;YAC7C,KAAI,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;;QACrD,CAAC;QAEM,oBAAG,GAAV,UAAW,GAAG;YACV,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACnB,CAAC;QAEM,8BAAa,GAApB;YACI,OAAO,GAAG,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC7D,CAAC;QAEM,sBAAK,GAAZ;YACI,OAAO,IAAI,CAAC,GAAG,KAAK,IAAI,CAAA;QAC5B,CAAC;QACL,aAAC;IAAD,CAAC,AAtBD,CAA4B,iBAAiB,GAsB5C;IAtBY,UAAM,SAsBlB,CAAA;AACL,CAAC,EAhOgB,GAAG,GAAH,WAAG,KAAH,WAAG,QAgOnB","sourcesContent":["import {message} from \"../message/messenger\";\n\nexport namespace cli {\n    import Messenger = message.Messenger;\n\n    export class Executable {\n\n        path: string;\n        flags: Flag[];\n        options: Option[];\n        args: Arg[];\n        messenger: Messenger;\n\n        constructor(path, flags, options, args, messenger) {\n            this.path = path;\n            this.flags = flags;\n            this.options = options;\n            this.args = args;\n            this.messenger = messenger;\n        }\n\n        // TODO: put counting logic here\n        public b_primed(): boolean {\n            return this.get_unset_parameters().length > 0;\n        }\n\n        public get_unset_parameters(): string[] {\n            let unset_parameters: string[] = [];\n\n            // flags\n            for (let flag of this.flags) {\n                if (!flag.b_set()) {\n                    unset_parameters.push(flag.name)\n                }\n            }\n\n            // options\n            for (let option of this.options) {\n                if (!option.b_set()) {\n                    unset_parameters.push(option.name)\n                }\n            }\n\n            // args\n            for (let arg of this.args) {\n                if (!arg.b_set()) {\n                    unset_parameters.push(arg.name)\n                }\n            }\n\n            return unset_parameters;\n        }\n\n        public get_command_exec(): string {\n            return this.path;\n        }\n\n        public get_arg(name_arg) {\n            return this.args.filter((arg) => {\n                return arg.name === name_arg;\n            })[0];\n        }\n\n        public get_opt(name_opt) {\n            return this.options.filter((opt) => {\n                return opt.name === name_opt;\n            })[0];\n        }\n\n        public get_flag(name_flag) {\n            return this.flags.filter((flag) => {\n                return flag.name === name_flag;\n            })[0];\n        }\n\n        public get_run_command() {\n            let command_exec: string = this.get_command_exec();\n\n            let argv: string[] = [];\n\n            for (let flag of this.flags) {\n                if (flag.b_set()) {\n                    argv.push(flag.get_name_exec());\n                }\n            }\n\n            // options\n            for (let option of this.options) {\n                if (option.b_set()) {\n                    argv.push(option.get_name_exec());\n                }\n            }\n\n            // args\n            for (let arg of this.args) {\n                if (arg.b_set()) {\n                    argv.push(arg.get_name_exec());\n                }\n            }\n\n            return command_exec + ' ' + argv.join(' ');\n        }\n\n        public run() {\n            let unset_params = this.get_unset_parameters();\n            if (unset_params.length > 0) {\n                throw 'unset parameters: ' + unset_params\n            }\n            this.messenger.message(this.get_run_command().split(' '));\n        }\n    }\n\n    abstract class MaxShellParameter {\n        needs_escaping_max: boolean;\n        needs_escaping_shell: boolean;\n\n        _preprocess_max(val): string {\n            if (this.needs_escaping_max) {\n                return '\\\\\"' + val + '\\\\\"';\n            } else {\n                return val;\n            }\n        }\n\n        _preprocess_shell(val): string {\n            if (this.needs_escaping_shell) {\n                // val = val.split(' ').join('\\\\\\\\\\\\\\\\ ');\n                // post(val);\n                // return val;\n                // return val.split(' ').join('\\\\\\\\\\\\\\\\ ');\n                return val.split(' ').join('\\\\\\\\ ');\n\n            } else {\n                return val;\n            }\n        }\n\n        _preprocess(val): string {\n            if (this.needs_escaping_max && this.needs_escaping_shell) {\n                // TODO: take care of this\n                throw 'you better take care of this now'\n            }\n            if (this.needs_escaping_max) {\n                return this._preprocess_max(val)\n            }\n            if (this.needs_escaping_shell) {\n                return this._preprocess_shell(val)\n            }\n\n            return val;\n        }\n    }\n\n    export class Arg extends MaxShellParameter {\n        name: string;\n        val: string;\n\n        constructor(name, needs_escaping_max?: boolean, needs_escaping_shell?: boolean) {\n            super();\n            this.name = name;\n            this.needs_escaping_max = needs_escaping_max;\n            this.needs_escaping_shell = needs_escaping_shell;\n        }\n\n        public set(val) {\n            this.val = val;\n        }\n\n        public get_name_exec() {\n            return this._preprocess(this.val)\n        }\n\n        // public get_name_exec() {\n        //     return '-' + this.name + ' ' + this._preprocess(this.val)\n        // }\n\n        public b_set(): boolean {\n            return this.val !== null\n        }\n    }\n\n    export class Flag extends MaxShellParameter {\n        name: string;\n        val: boolean;\n\n        constructor(name) {\n            super();\n            this.name = name;\n        }\n\n        public set(val) {\n            this.val = val;\n        }\n\n        public get_name_exec() {\n            return '-' + this.name\n        }\n\n        public b_set(): boolean {\n            return this.val\n        }\n    }\n\n    export class Option extends MaxShellParameter {\n        name: string;\n        val: string;\n\n        constructor(name, needs_escaping_max?: boolean, needs_escaping_shell?: boolean) {\n            super();\n            this.name = name;\n            this.needs_escaping_max = needs_escaping_max;\n            this.needs_escaping_shell = needs_escaping_shell;\n        }\n\n        public set(val) {\n            this.val = val;\n        }\n\n        public get_name_exec() {\n            return '-' + this.name + ' ' + this._preprocess(this.val)\n        }\n\n        public b_set(): boolean {\n            return this.val !== null\n        }\n    }\n}"]}