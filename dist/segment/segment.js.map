{"version":3,"file":"segment.js","sourceRoot":"","sources":["../../src/segment/segment.ts"],"names":[],"mappings":"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","sourcesContent":["import {clip} from \"../clip/clip\";\nimport {note, note as n} from \"../note/note\";\nimport TreeModel = require(\"tree-model\");\nimport {live} from \"../live/live\";\nimport {scene} from \"../scene/scene\";\n\nexport namespace segment {\n\n    import Clip = clip.Clip;\n    import Note = note.Note;\n    import LiveClipVirtual = live.LiveClipVirtual;\n    import Scene = scene.Scene;\n    import ClipLive = live.ClipLive;\n\n    export class Segment {\n\n        beat_start: number;\n        beat_end: number;\n        scene: Scene;\n        clip: Clip; // used as storage with an interface similar to Live\n        clip_user_input_sync: Clip;\n        clip_user_input_async: Clip;\n\n        constructor(note: TreeModel.Node<n.Note>) {\n            this.beat_start = note.model.note.beat_start;\n            this.beat_end = note.model.note.get_beat_end();\n            let clip_dao_virtual = new LiveClipVirtual([note]);\n            this.clip = new Clip(clip_dao_virtual);\n        }\n\n        public static from_notes(notes: TreeModel.Node<Note>[]): Segment[] {\n            return\n        }\n\n        public set_clip_user_input_sync(clip: Clip) {\n            this.clip_user_input_sync = clip;\n        }\n\n        public set_clip_user_input_async(clip: Clip) {\n            this.clip_user_input_async = clip;\n        }\n\n        public get_note(): TreeModel.Node<n.Note> {\n            return this.clip.get_notes(\n                this.beat_start,\n                0,\n                this.beat_end,\n                128\n            )[0]\n        }\n\n        public get_notes(): TreeModel.Node<n.Note>[] {\n            return this.clip.get_notes(\n                this.beat_start,\n                0,\n                this.beat_end,\n                128\n            )\n        }\n\n        public get_endpoints_loop() {\n            return [this.beat_start, this.beat_end]\n        }\n\n        public set_endpoints_loop(beat_start, beat_end) {\n            this.clip.set_loop_bracket_upper(beat_end);\n            this.clip.set_loop_bracket_lower(beat_start);\n        }\n\n        public set_scene(scene: Scene) {\n            this.scene = scene;\n        }\n\n        // public get_beat_lower() {\n        //     return this.clip.get_loop_bracket_lower()\n        // }\n        //\n        // public get_beat_upper() {\n        //     return this.clip.get_loop_bracket_upper()\n        // }\n    }\n\n    export class SegmentIterator {\n        private segments: Segment[];\n        public direction_forward: boolean;\n        private i: number;\n\n        constructor(segments: Segment[], direction_forward: boolean) {\n            this.segments = segments;\n            this.direction_forward = direction_forward;\n            this.i = -1;\n        }\n\n        // TODO: type declarations\n        public next() {\n            let value_increment = (this.direction_forward) ? 1 : -1;\n\n            this.i += value_increment;\n\n            if (this.i < 0) {\n                throw 'segment iterator < 0'\n            }\n\n            if (this.i < this.segments.length) {\n                return {\n                    value: this.segments[this.i],\n                    done: false\n                }\n            } else {\n                return {\n                    value: null,\n                    done: true\n                }\n            }\n        }\n\n        public current() {\n            if (this.i > -1) {\n                return this.segments[this.i];\n            } else {\n                return null;\n            }\n        }\n\n        public reset() {\n            this.i = -1;\n        }\n\n        public get_index_current() {\n            return this.i;\n        }\n    }\n}"]}