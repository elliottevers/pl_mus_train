{"version":3,"file":"note.js","sourceRoot":"","sources":["note.ts"],"names":[],"mappings":"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","sourcesContent":["import TreeModel = require(\"tree-model\");\nimport p = require(\"../parse/parse\");\n\nexport namespace note {\n\n    export class Note implements p.parse.Parsable {\n\n        public pitch: number;\n        public beat_start: number;\n        public beats_duration: number;\n        public velocity: number;\n        public muted: number;\n        public _b_has_chosen: boolean;\n\n        constructor(\n            pitch: number,\n            beat_start: number,\n            beats_duration: number,\n            velocity: number,\n            muted: number\n        ) {\n            this.pitch = pitch;\n            this.beat_start = beat_start;\n            this.beats_duration = beats_duration;\n            this.velocity = velocity;\n            this.muted = muted;\n            this._b_has_chosen = false;\n        }\n\n        static get_overlap_beats(\n            beat_start_former: number,\n            beat_end_former: number,\n            beat_start_latter: number,\n            beat_end_latter: number\n        ) {\n            let a = beat_start_former, b = beat_end_former, c = beat_start_latter, d = beat_end_latter;\n            let former_starts_before_latter = (a <= c);\n            let former_ends_before_latter = (b <= d);\n\n            // TODO: check logic\n            if (former_starts_before_latter && former_ends_before_latter) {\n                return b - c;\n            } else if (former_starts_before_latter && !former_ends_before_latter) {\n                return a - c;\n            } else if (!former_starts_before_latter && !former_ends_before_latter) {\n                return 0;\n            } else if (!former_starts_before_latter && former_ends_before_latter) {\n                return b - a;\n            }\n\n            throw 'case not considered'\n\n        }\n\n        get_beat_end():number {\n            return this.beat_start + this.beats_duration;\n        }\n\n        get_interval_beats():number[] {\n            return [this.beat_start, this.get_beat_end()];\n        }\n\n        // TODO: add type of argument and return value\n        get_best_candidate(list_candidate_note: TreeModel.Node<Note>[])  {\n            let beats_overlap, beats_max_overlap, list_candidate_note_max_overlap;\n\n            list_candidate_note_max_overlap = [];\n            beats_max_overlap = 0;\n\n            for (let candidate_note of list_candidate_note) {\n                beats_overlap = Note.get_overlap_beats(\n                    this.beat_start,\n                    this.beat_start + this.beats_duration,\n                    candidate_note.model.note.beat_start,\n                    candidate_note.model.note.beat_start + candidate_note.model.note.beats_duration\n                );\n                if (beats_overlap > beats_max_overlap) {\n                    beats_max_overlap = beats_overlap;\n                    list_candidate_note_max_overlap = [];\n                }\n                if (beats_overlap === beats_max_overlap) {\n                    list_candidate_note_max_overlap.push(candidate_note);\n                }\n            }\n\n            function compare(note_former: TreeModel.Node<Note>, note_latter: TreeModel.Node<Note>) {\n                if (note_former.model.note.beat_start < note_latter.model.note.beat_start)\n                    return -1;\n                if (note_former.model.note.beat_start > note_latter.model.note.beat_start)\n                    return 1;\n                return 0;\n            }\n\n            list_candidate_note_max_overlap.sort(compare);\n\n            return list_candidate_note_max_overlap[0];\n        }\n\n        choose(): boolean {\n            if (!this._b_has_chosen) {\n                // tree.children[0].appendChild(left_left).appendChild(left_right);\n                // note_parent.addChild(this);\n                this._b_has_chosen = true;\n                return true;\n            } else {\n                return false;\n            }\n        }\n    }\n\n    export class NoteIterator {\n\n        private notes: TreeModel.Node<Note>[];\n        public direction_forward: boolean;\n        private i: number;\n\n        constructor(notes: TreeModel.Node<Note>[], direction_forward: boolean) {\n                this.notes = notes;\n                this.direction_forward = direction_forward;\n                this.i = -1;\n        }\n\n        // TODO: type declarations\n        public next() {\n            let value_increment = (this.direction_forward) ? 1 : -1;\n\n            this.i += value_increment;\n\n            if (this.i < 0) {\n                throw 'note iterator < 0'\n            }\n\n            if (this.i < this.notes.length) {\n                return {\n                    value: this.notes[this.i],\n                    done: false\n                }\n            } else {\n                return {\n                    value: null,\n                    done: true\n                }\n            }\n        }\n\n        public current() {\n            if (this.i > -1) {\n                return this.notes[this.i];\n            } else {\n                return null;\n            }\n        }\n    }\n}"]}