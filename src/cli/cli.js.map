{"version":3,"file":"cli.js","sourceRoot":"","sources":["cli.ts"],"names":[],"mappings":"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","sourcesContent":["import {message} from \"../message/messenger\";\n\nexport namespace cli {\n\n    import Messenger = message.Messenger;\n\n    interface Runnable {\n        get_command_exec();\n        run();\n    }\n\n    abstract class Parameterized {\n        flags: Flag[];\n        options: Option[];\n        args: Arg[];\n        messenger: Messenger;\n\n        // TODO: put counting logic here\n        public b_primed(): boolean {\n            return this.get_unset_parameters().length > 0;\n        }\n\n        public get_unset_parameters(): string[] {\n            let unset_parameters: string[] = [];\n\n            // flags\n            for (let flag of this.flags) {\n                if (!flag.b_set()) {\n                    unset_parameters.push(flag.name)\n                }\n            }\n\n            // options\n            for (let option of this.options) {\n                if (!option.b_set()) {\n                    unset_parameters.push(option.name)\n                }\n            }\n\n            // args\n            for (let arg of this.args) {\n                if (!arg.b_set()) {\n                    unset_parameters.push(arg.name)\n                }\n            }\n\n            return unset_parameters;\n        }\n\n        public get_arg(name_arg) {\n            return this.args.filter((arg) => {\n                return arg.name === name_arg;\n            })[0];\n        }\n\n        public get_opt(name_opt) {\n            return this.options.filter((opt) => {\n                return opt.name === name_opt;\n            })[0];\n        }\n\n        public get_flag(name_flag) {\n            return this.flags.filter((flag) => {\n                return flag.name === name_flag;\n            })[0];\n        }\n\n        public get_run_parameters() {\n            // let command_exec: string = this.get_command_exec();\n\n            let argv: string[] = [];\n\n            for (let flag of this.flags) {\n                if (flag.b_set()) {\n                    argv.push(flag.get_name_exec());\n                }\n            }\n\n            // options\n            for (let option of this.options) {\n                if (option.b_set()) {\n                    argv.push(option.get_name_exec());\n                }\n            }\n\n            // args\n            for (let arg of this.args) {\n                if (arg.b_set()) {\n                    argv.push(arg.get_name_exec());\n                }\n            }\n\n            // return command_exec + ' ' + argv.join(' ');\n            return argv.join(' ');\n        }\n\n        protected preprocess_shell(val) {\n            return val.split(' ').join('\\\\\\\\ ');\n        }\n\n        protected preprocess_max(val) {\n            return '\\\\\"' + val + '\\\\\"';\n        }\n    }\n\n    export class Script extends Parameterized implements Runnable {\n\n        interpreter: string;\n        script: string;\n        escape_paths: boolean;\n\n        constructor(interpreter, script, flags, options, args, messenger?, escape_paths?: boolean) {\n            super();\n            this.interpreter = interpreter;\n            this.script = script;\n            this.flags = flags;\n            this.options = options;\n            this.args = args;\n            this.messenger = messenger;\n            // TODO: do better\n            this.escape_paths = escape_paths;\n        }\n\n        public get_command_exec = () => {\n            if (this.escape_paths) {\n                return this.preprocess_max(this.preprocess_shell(this.interpreter) + ' ' + this.preprocess_shell(this.script));\n            } else {\n                return this.interpreter + ' ' + this.script;\n            }\n        };\n\n        public run() {\n            this.messenger.message(this.get_command_full());\n        }\n\n\n        public get_command_full = () => {\n            let unset_params = this.get_unset_parameters();\n            if (unset_params.length > 0) {\n                throw 'unset parameters: ' + unset_params\n            }\n            let command_full = [this.get_command_exec()].concat(this.get_run_parameters().split(' '));\n            return command_full\n        };\n    }\n\n    export class Executable extends Parameterized implements Runnable {\n\n        path: string;\n        escape_paths: boolean;\n\n        constructor(path, flags, options, args, messenger?, escape_paths?: boolean) {\n            super();\n            this.path = path;\n            this.flags = flags;\n            this.options = options;\n            this.args = args;\n            this.messenger = messenger;\n            this.escape_paths = escape_paths;\n        }\n\n        public get_command_exec = () => {\n            if (this.escape_paths) {\n                return this.preprocess_max(this.preprocess_shell(this.path));\n            } else {\n                return this.path;\n            }\n        };\n\n        public get_command_full = () => {\n            let unset_params = this.get_unset_parameters();\n            if (unset_params.length > 0) {\n                throw 'unset parameters: ' + unset_params\n            }\n            let command_full = [this.get_command_exec()].concat(this.get_run_parameters().split(' '));\n            return command_full\n        };\n\n        public run() {\n            this.messenger.message(this.get_command_full());\n        }\n    }\n\n    abstract class MaxShellParameter {\n        needs_escaping_max: boolean;\n        needs_escaping_max_shell: boolean;\n        needs_escaping_shell: boolean;\n\n        _preprocess_max(val): string {\n            if (this.needs_escaping_max) {\n                return '\\\\\"' + val + '\\\\\"';\n            } else {\n                return val;\n            }\n        }\n\n        _preprocess_max_shell(val): string {\n            if (this.needs_escaping_max_shell) {\n                return val.split(' ').join('\\\\\\\\ ');\n\n            } else {\n                return val;\n            }\n        }\n\n        _preprocess_shell(val): string {\n            if (this.needs_escaping_shell) {\n                return \"\\\"\" + val + \"\\\"\";\n\n            } else {\n                return val;\n            }\n        }\n\n        _preprocess(val): string {\n            if (this.needs_escaping_max && this.needs_escaping_max_shell) {\n                // TODO: take care of this\n                throw 'you better take care of this now'\n            }\n            if (this.needs_escaping_max) {\n                return this._preprocess_max(val)\n            }\n            if (this.needs_escaping_max_shell) {\n                return this._preprocess_max_shell(val)\n            }\n            if (this.needs_escaping_shell) {\n                return this._preprocess_shell(val);\n            }\n\n            return val;\n        }\n    }\n\n    export class Arg extends MaxShellParameter {\n        name: string;\n        val: string;\n\n        constructor(name, needs_escaping_max?: boolean, needs_escaping_max_shell?: boolean, needs_escaping_shell?: boolean) {\n            super();\n            this.name = name;\n            this.needs_escaping_max = needs_escaping_max;\n            this.needs_escaping_max_shell = needs_escaping_max_shell;\n        }\n\n        public set(val) {\n            this.val = val;\n        }\n\n        public get_name_exec() {\n            return this._preprocess(this.val)\n        }\n\n        public b_set(): boolean {\n            return this.val !== null\n        }\n    }\n\n    export class Flag extends MaxShellParameter {\n        name: string;\n        val: boolean;\n\n        constructor(name) {\n            super();\n            this.name = name;\n        }\n\n        public set(val) {\n            this.val = val;\n        }\n\n        public get_name_exec() {\n            return '-' + this.name\n        }\n\n        public b_set(): boolean {\n            return this.val\n        }\n    }\n\n    export class Option extends MaxShellParameter {\n        name: string;\n        val: string;\n        num_dashes: number;\n\n        constructor(name, needs_escaping_max?: boolean, needs_escaping_max_shell?: boolean, needs_escaping_shell?: boolean, num_dashes?: number) {\n            super();\n            this.name = name;\n            this.needs_escaping_max = needs_escaping_max;\n            this.needs_escaping_max_shell = needs_escaping_max_shell;\n            this.needs_escaping_shell = needs_escaping_shell;\n            this.num_dashes = num_dashes\n        }\n\n        public set(val) {\n            this.val = val;\n        }\n\n        public get_name_exec() {\n            return (this.num_dashes === 1 ? '-' : '--') + this.name + ' ' + this._preprocess(this.val)\n        }\n\n        public b_set(): boolean {\n            return this.val !== null\n        }\n    }\n}"]}