{"version":3,"file":"io.js","sourceRoot":"","sources":["io.ts"],"names":[],"mappings":"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","sourcesContent":["import {clip as c} from \"../clip/clip\";\nimport {note as n} from \"../note/note\";\nimport TreeModel = require(\"tree-model\");\nimport {message} from \"../message/messenger\";\nimport {log} from \"../log/logger\";\n\nexport namespace io {\n\n    import Messenger = message.Messenger;\n    import Logger = log.Logger;\n    declare let Dict: any;\n\n    export class Exporter {\n\n        public filepath_export: string;\n\n        private dict: any;\n\n        private clips: object;\n\n        private tempo: number;\n\n        private length_beats: number;\n\n        constructor(filepath_export, name_dict?:string) {\n            this.filepath_export = filepath_export;\n            this.dict = new Dict(name_dict);\n            this.clips = {};\n        }\n\n        public set_notes(name_part: string, notes): void {\n            this.clips[name_part] = notes;\n        }\n\n        public unset_notes(name_part: string): void {\n            this.clips[name_part] = null;\n        }\n\n        public set_tempo(bpm: number) {\n            this.tempo = bpm;\n        }\n\n        public set_length(beats: number) {\n            this.length_beats = beats;\n        }\n\n        public static get_messages(notes) {\n            let messages = [];\n\n            messages.push(\n                ['notes', notes.length.toString()].join(' ')\n            );\n\n            for (let i_note in notes) {\n                messages.push(notes[i_note].model.note.encode());\n            }\n\n            messages.push(\n                ['notes', 'done'].join(' ')\n            );\n\n            return messages\n        }\n\n        public export_clips(partnames): void {\n            let messenger = new Messenger('max', 0);\n            for (let name_part in this.clips) {\n                let notes = this.clips[name_part];\n                if (partnames.indexOf(name_part) !== -1) {\n                    let key = [name_part, 'notes'].join('::');\n                    this.dict.replace(key, \"\");\n                    this.dict.set(key, ...Exporter.get_messages(notes));\n                }\n            }\n            this.dict.replace('tempo', this.tempo);\n            this.dict.replace('length_beats', this.length_beats);\n            this.dict.export_json(this.filepath_export);\n            messenger.message(['python'])\n        }\n    }\n\n    export class Importer {\n\n        public filepath_import: string;\n\n        private dict: any;\n\n        private name_dict: string;\n\n        constructor(filepath_import, name_dict?:string) {\n            this.filepath_import = filepath_import;\n            this.name_dict = name_dict;\n            this.dict = new Dict(name_dict);\n        }\n\n        public import() {\n            this.dict.import_json(this.filepath_import);\n        }\n\n        public get_notes(name_part): TreeModel.Node<n.Note>[] {\n            let key = [this.name_dict, name_part, 'notes'].join('::');\n            let logger = new Logger('max');\n            logger.log(key.toString());\n            return c.Clip.parse_note_messages(\n                this.dict.get(key)\n            )\n        }\n    }\n}"]}