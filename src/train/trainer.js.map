{"version":3,"file":"trainer.js","sourceRoot":"","sources":["trainer.ts"],"names":[],"mappings":";;AAAA,qCAA6C;AAC7C,sCAAyC;AACzC,yCAAsC;AACtC,8CAA2C;AAC3C,2CAAwC;AAExC,wCAAqC;AACrC,kDAA6C;AAE7C,qCAAkC;AAClC,qCAAkC;AAGlC,wCAAqC;AACrC,qCAAkC;AAClC,IAAM,CAAC,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AAChC,IAAM,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAE5B,IAAiB,OAAO,CA4mBvB;AA5mBD,WAAiB,OAAO;IAEpB,IAAO,gBAAgB,GAAG,iBAAO,CAAC,gBAAgB,CAAC;IACnD,IAAO,cAAc,GAAG,eAAM,CAAC,cAAc,CAAC;IAE9C,IAAO,KAAK,GAAG,qBAAS,CAAC,KAAK,CAAC;IAC/B,IAAO,MAAM,GAAG,qBAAS,CAAC,MAAM,CAAC;IACjC,IAAO,MAAM,GAAG,qBAAS,CAAC,MAAM,CAAC;IACjC,IAAO,OAAO,GAAG,qBAAS,CAAC,OAAO,CAAC;IAGnC,IAAO,SAAS,GAAG,mBAAO,CAAC,SAAS,CAAC;IAErC,IAAO,IAAI,GAAG,WAAI,CAAC,IAAI,CAAC;IAExB,IAAO,WAAW,GAAG,aAAK,CAAC,WAAW,CAAC;IAEvC,IAAO,2BAA2B,GAAG,iBAAO,CAAC,2BAA2B,CAAC;IACzE,IAAO,oBAAoB,GAAG,iBAAO,CAAC,oBAAoB,CAAC;IAC3D,IAAO,IAAI,GAAG,WAAI,CAAC,IAAI,CAAC;IAExB,IAAO,OAAO,GAAG,WAAI,CAAC,OAAO,CAAC;IAC9B,IAAO,SAAS,GAAG,WAAI,CAAC,SAAS,CAAC;IAElC;QA4BI,iBAAY,MAAM,EAAE,kBAAkB,EAAE,SAAS,EAAE,eAAe,EAAE,2BAA2B,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS;YACpI,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;YACrB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAC3B,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;YACvC,IAAI,CAAC,2BAA2B,GAAG,2BAA2B,CAAC;YAC/D,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;YACjC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;YAE3B,IAAI,CAAC,qBAAqB,GAAG,oBAAoB,CAAC,kBAAkB,CAChE,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,QAAQ,CAChB,CAAC;YAEF,IAAI,CAAC,YAAY,GAAG,2BAA2B,CAAC,mBAAmB,CAC/D,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,QAAQ,CAChB,CAAC;YAEF,IAAI,CAAC,kBAAkB,GAAG,IAAI,gBAAgB,CAC1C,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CACjC,CAAC;YAEF,IAAI,CAAC,MAAM,CAAC,gBAAgB,CACxB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,QAAQ,CAChB,CAAC;YAEF,IAAI,CAAC,MAAM,CAAC,gBAAgB,CACxB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,QAAQ,CACnD,CAAC;YAEF,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE;gBAC7B,IAAI,CAAC,cAAc,EAAE,CAAA;aACxB;iBAAM;gBACH,IAAI,CAAC,YAAY,GAAG,IAAI,WAAW,CAC/B,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CACjC,CAAC;gBACF,IAAI,CAAC,uBAAuB,EAAE,CAAC;aAClC;QACL,CAAC;QAEO,yCAAuB,GAA/B;YAEI,IAAI,iBAAiB,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC;YAE3E,IAAI,IAAI,GAAc,IAAI,SAAS,EAAE,CAAC;YAEtC,IAAI,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAC7B;gBACI,EAAE,EAAE,CAAC,CAAC;gBACN,IAAI,EAAE,IAAI,WAAC,CAAC,IAAI,CACZ,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAClC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,EACjD,CAAC,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,GAAG,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,EAC3I,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EACrC,iBAAiB,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CACrC;gBACD,QAAQ,EAAE,EAET;aACJ,CACJ,CAAC;YAEF,IAAI,CAAC,YAAY,CAAC,QAAQ,CACtB,gBAAgB,CACnB,CAAC;YAEF,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,KAAK,MAAM,EAAE;gBACtC,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;aAC3C;YAED,oDAAoD;YAEpD,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAC7B,gBAAgB,CACnB,CAAC;YAEF,8DAA8D;YAE9D,KAAK,IAAI,SAAS,IAAI,IAAI,CAAC,QAAQ,EAAE;gBAEjC,IAAI,SAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;gBAE/C,kCAAkC;gBAClC,EAAE;gBACF,uCAAuC;gBAEvC,IAAI,MAAI,GAAG,SAAO,CAAC,QAAQ,EAAE,CAAC;gBAE9B,IAAI,qBAAqB,GAAG,CAAC,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;gBAEnD,QAAQ,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE;oBAC/B,KAAK,MAAM,CAAC,CAAC;wBACT,IAAI,CAAC,YAAY,CAAC,GAAG,CACjB,CAAC,MAAI,CAAC,EACN,qBAAqB,EACrB,IAAI,CAAC,SAAS,CACjB,CAAC;wBACF,MAAM;qBACT;oBACD,KAAK,KAAK,CAAC,CAAC;wBACR,IAAI,CAAC,YAAY,CAAC,SAAS,CACvB,CAAC,MAAI,CAAC,EACN,qBAAqB,CACxB,CAAC;wBACF,MAAM;qBACT;iBACJ;gBAED,IAAI,CAAC,MAAM,CAAC,iBAAiB,CACzB,CAAC,MAAI,CAAC,EACN,qBAAqB,CACxB,CAAC;gBAEF,IAAI,CAAC,kBAAkB,CAAC,GAAG,CACvB,CAAC,MAAI,CAAC,EACN,qBAAqB,CACxB,CAAC;gBAEF,IAAI,CAAC,qBAAqB,EAAE,CAAC;aAChC;YAED,QAAQ,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE;gBAC/B,KAAK,KAAK,CAAC,CAAC;4CAOC,SAAS;wBACd,IAAI,SAAO,GAAG,OAAK,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;wBAC/C,0CAA0C;wBAC1C,0BAA0B;wBAC1B,SAAS;wBACT,6CAA6C;wBAC7C,UAAU;wBACV,KAAK;wBAEL,IAAI,KAAK,GAAG,OAAK,YAAY,CAAC,MAAM,CAChC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,IAAI,SAAO,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,SAAO,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,EAAlI,CAAkI,CAC7I,CAAC;wBAEF,IAAI,qBAAqB,GAAG,CAAC,OAAK,SAAS,CAAC,SAAS,EAAE,GAAG,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;wBAEhF,OAAK,YAAY,CAAC,SAAS,CACvB,KAAK,EACL,qBAAqB,CACxB,CAAC;wBACF,OAAK,MAAM,CAAC,iBAAiB,CACzB,KAAK,EACL,qBAAqB,CACxB,CAAA;;;oBA3BL,gDAAgD;oBAChD,iJAAiJ;oBACjJ,KAAK;oBAEL,qBAAqB;oBACrB,KAAK,IAAI,SAAS,IAAI,IAAI,CAAC,QAAQ;gCAA1B,SAAS;qBAuBjB;oBACD,MAAM;iBACT;gBACD,KAAK,MAAM,CAAC,CAAC;oBACT,mBAAmB;oBACnB,MAAM;iBACT;gBACD,OAAO,CAAC,CAAC;oBACL,MAAM,CAAC,mBAAmB,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE,eAAe,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;iBACpF;aACJ;QACL,CAAC;QAED,uDAAuD;QAC/C,gCAAc,GAAtB;YAEI,0BAA0B;YAC1B,gDAAgD;oCAEvC,SAAS;gBACd,IAAI,SAAO,GAAG,OAAK,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;gBAE/C,IAAI,gBAAgB,GAAG,OAAK,YAAY,CAAC,MAAM,CAC3C,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,IAAI,SAAO,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,SAAO,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,EAAlI,CAAkI,CAC7I,CAAC;gBAEF,IAAI,gBAAgB,GAAG,OAAK,SAAS,CAAC,iBAAiB;gBACnD,8BAA8B;gBAC9B,mDAAmD;gBACnD,SAAS;gBACT,+FAA+F;gBAC/F,UAAU;gBACV,IAAI;gBACJ,gBAAgB,CACnB,CAAC;gBAEF,KAAmB,UAAgB,EAAhB,qCAAgB,EAAhB,8BAAgB,EAAhB,IAAgB,EAAE;oBAAhC,IAAI,QAAM,yBAAA;oBACX,KAAsB,UAAM,EAAN,WAAA,QAAM,EAAN,oBAAM,EAAN,IAAM,EAAE;wBAAzB,IAAI,SAAS,eAAA;wBAEd,IAAI,mBAAmB,GAAG,OAAK,SAAS,CAAC,qBAAqB,CAC1D,SAAS,CACZ,CAAC;wBAEF,OAAK,eAAe,CAAC,YAAY,CAC7B,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,EACzC,CAAC,EACD,mBAAmB,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,EAC7C,GAAG,CACN,CAAC;wBAEF,OAAK,eAAe,CAAC,SAAS,CAC1B,CAAC,mBAAmB,CAAC,CACxB,CAAA;qBACJ;iBACJ;gBAED,OAAK,YAAY,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,cAAc,CAAC,oBAAoB,CAAC,gBAAgB,CAAC,CAAC;;;YArCpG,KAAK,IAAI,SAAS,IAAI,IAAI,CAAC,QAAQ;wBAA1B,SAAS;aAsCjB;QAGL,CAAC;QAEM,8BAAY,GAAnB;YACI,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAA;QACvB,CAAC;QAEM,+BAAa,GAApB;YACI,IAAI,KAAK,GAAG,EAAE,CAAC;YACf,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE;gBAC7B,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,UAAU,CAAC,GAAG,CAAC,UAAC,SAAS;oBACpE,OAAO,SAAS,CAAC,IAAI,CAAA;gBACzB,CAAC,CAAC,CAAA;aACL;YACD,WAAW;YACX,mDAAmD;YACnD,iBAAiB;YACjB,IAAI;YACJ,IAAI,CAAC,MAAM,CAAC,MAAM,CACd,IAAI,CAAC,qBAAqB,EAC1B,KAAK,EACL,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,YAAY,CACpB,CAAA;QACL,CAAC;QAEM,kCAAgB,GAAvB;YACI,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,OAAO,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,EAAE;gBAC1D,IAAI,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CAAC;gBAC5D,IAAI,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;gBACzE,IAAI,CAAC,eAAe,CAAC,SAAS,CAC1B,UAAU,CACb,CAAC;aACL;iBAAM;gBACH,OAAM;aACT;QACL,CAAC;QAED,uBAAuB;QACvB,gEAAgE;QAChE,EAAE;QACF,+CAA+C;QAC/C,uBAAuB;QACvB,sBAAsB;QACtB,QAAQ;QACR,IAAI;QAEI,+BAAa,GAArB,UAAsB,UAAoB;YACtC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAEtC,IAAI,UAAU,EAAE;gBACZ,OAAM;aACT;YAED,8BAA8B;YAC9B,IAAI,mBAAmB,GAAG,IAAI,CAAC,2BAA2B,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACjF,IAAI,wBAAwB,GAAG,mBAAmB,CAAC,mBAAmB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACnF,IAAI,gBAAgB,GAAG,mBAAmB,CAAC;YAC3C,gBAAgB,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,wBAAwB,GAAG,CAAC,CAAC;YAE7E,IAAI,CAAC,2BAA2B,GAAG,IAAI,IAAI,CACvC,IAAI,OAAO,CACP,IAAI,SAAS,CACT,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAC7B,EACD,IAAI,SAAS,CAAC,KAAK,EAAE,CAAC,CAAC,CAC1B,CACJ,CAAC;YAEF,2BAA2B;YAC3B,IAAI,iBAAiB,GAAG,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACnE,IAAI,sBAAsB,GAAG,iBAAiB,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAC7E,IAAI,cAAc,GAAG,iBAAiB,CAAC;YACvC,cAAc,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,sBAAsB,GAAG,CAAC,CAAC;YACvE,IAAI,oBAAoB,GAAG,IAAI,IAAI,CAC/B,IAAI,OAAO,CACP,IAAI,SAAS,CACT,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAC3B,EACD,IAAI,SAAS,CAAC,KAAK,EAAE,CAAC,CAAC,EACvB,IAAI,EACJ,iBAAiB,CACpB,CACJ,CAAC;YACF,oBAAoB,CAAC,iBAAiB,CAAC,0BAA0B,CAAC,CAAC;YAEnE,IAAI,CAAC,eAAe,GAAG,oBAAoB,CAAC;QAChD,CAAC;QAEM,wBAAM,GAAb;YACI,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAA;QAC9B,CAAC;QAEM,uBAAK,GAAZ;YACI,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAA;QACjE,CAAC;QAEM,2BAAS,GAAhB;YACI,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAA;QACjE,CAAC;QAEM,sBAAI,GAAX,UAAY,OAAiB;YACzB,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE;gBAC7B,IAAI,CAAC,iBAAiB,EAAE,CAAC;aAC5B;iBAAM;gBACH,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;aAC9B;YACD,IAAI,CAAC,OAAO,EAAE;gBACV,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAA;aAE5D;QACL,CAAC;QAEO,iCAAe,GAAvB,UAAwB,UAAoB;YAExC,IAAI,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;YAEvD,IAAI,cAAc,CAAC,IAAI,EAAE;gBACrB,QAAO,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE;oBAC9B,KAAK,KAAK,CAAC,CAAC;wBAER,iCAAiC;wBACjC,KAAK,IAAI,SAAS,IAAI,IAAI,CAAC,QAAQ,EAAE;4BACjC,IAAI,SAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;4BAC/C,IAAI,CAAC,YAAY,CAAC,GAAG,CACjB,CAAC,SAAO,CAAC,QAAQ,EAAE,CAAC,EACpB,CAAC,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,EACtB,IAAI,CAAC,SAAS,CACjB,CAAC;yBACL;wBAED,6BAA6B;wBAC7B,IAAI,CAAC,YAAY,CAAC,GAAG,CACjB,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC,CAAC,EACzD,CAAC,CAAC,CAAC,CAAC,EACJ,IAAI,CAAC,SAAS,CACjB,CAAC;wBACF,MAAM;qBACT;oBACD,KAAK,MAAM,CAAC,CAAC;wBACT,MAAM;qBACT;oBACD,OAAO,CAAC,CAAC;wBACL,MAAM,yBAAyB,CAAA;qBAClC;iBACJ;gBAED,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBAE9D,OAAM;aACT;YAED,IAAI,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC;YAEjC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAE/C,2BAA2B;YAC3B,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;QACnC,CAAC;QAEO,mCAAiB,GAAzB;YAAA,iBAoGC;YAlGG,IAAI,cAAc,GAAY,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC;YAEtE,IAAI,cAAc,EAAE;gBAChB,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;gBAElC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEvD,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,CAAC;gBAEpC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,CAAC;gBAE7D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;gBAEzE,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC;gBAEvC,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,0BAA0B,CAAC,OAAO,EAAE,CAAC;gBAEnE,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBAE9B,OAAM;aACT;YAED,IAAI,wBAAwB,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CACnD,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,IAAI,KAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,KAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,EAA5J,CAA4J,CACvK,CAAC;YAEF,IAAI,eAAe,GAAa,IAAI,CAAC,uBAAuB,CAAC,OAAO,CAAC;YAErE,IAAI,aAAa,GAAa,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CAAC;YAE7E,IAAI,kBAAkB,GAAG,IAAI,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC;YAEhE,IAAI,kBAAkB,CAAC,IAAI,EAAE;gBAEzB,IAAI,eAAe,GAAG,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,CAAC;gBAE1D,IAAI,eAAe,CAAC,IAAI,EAAE;oBAEtB,IAAI,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;oBAEvD,0DAA0D;oBAE1D,IAAI,uBAAuB,GAAG,EAAE,CAAC;oBAEjC,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,KAAK,OAAO,EAAE;wBACvC,uBAAuB,GAAG,wBAAwB,CAAA;qBACrD;yBAAM;wBACH,uBAAuB,GAAG,eAAe,CAAA;qBAC5C;oBAED,IAAI,CAAC,kBAAkB,CAAC,GAAG,CACvB,uBAAuB,EACvB,aAAa,CAChB,CAAC;oBAEF,IAAI,cAAc,CAAC,IAAI,EAAE;wBACrB,0DAA0D;wBAC1D,IAAI,CAAC,kBAAkB,CAAC,GAAG,CACvB,uBAAuB,EACvB,aAAa,CAChB,CAAC;wBAEF,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,CAAC;wBAE/B,OAAM;qBACT;oBAED,IAAI,UAAU,GAAG,cAAc,CAAC,KAAK,CAAC;oBAEtC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;oBAE/E,IAAI,CAAC,sBAAsB,EAAE,CAAC;oBAE9B,IAAI,4BAA4B,GAAG,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,CAAC;oBAEvE,IAAI,CAAC,cAAc,GAAG,4BAA4B,CAAC,KAAK,CAAC;oBAEzD,IAAI,+BAA+B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;oBAEpF,IAAI,CAAC,iBAAiB,GAAG,+BAA+B,CAAC,KAAK,CAAC;oBAE/D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;oBAEzE,OAAM;iBACT;gBAED,IAAI,CAAC,cAAc,GAAG,eAAe,CAAC,KAAK,CAAC;gBAE5C,IAAI,8BAA8B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;gBAEnF,IAAI,CAAC,iBAAiB,GAAG,8BAA8B,CAAC,KAAK,CAAC;gBAE9D,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC;gBAEzE,OAAM;aACT;YAED,IAAI,CAAC,iBAAiB,GAAG,kBAAkB,CAAC,KAAK,CAAC;QACtD,CAAC;QAED,wCAAsB,GAAtB;YACI,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAExF,2BAA2B;YAC3B,IAAI,CAAC,aAAa,EAAE,CAAC;YAErB,qCAAqC;YACrC,IAAI,CAAC,uBAAuB,EAAE,CAAC;YAC/B,WAAW;YACX,oCAAoC;YACpC,IAAI;QACR,CAAC;QAED,8BAAY,GAAZ,UAAa,gBAA0C;YAEnD,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAE1B,IAAI,IAAI,CAAC,kBAAkB,IAAI,IAAI,CAAC,gBAAgB,EAAE;gBAClD,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAA;aAClC;YAED,IAAI,IAAI,CAAC,mBAAmB,EAAE;gBAC1B,oBAAoB;gBACpB,OAAM;aACT;YAED,qBAAqB;YACrB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE;gBAE9B,IAAI,CAAC,kBAAkB,CAAC,GAAG,CACvB,gBAAgB,EAChB,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CACjD,CAAC;gBAEF,IAAI,CAAC,MAAM,CAAC,iBAAiB,CACzB,gBAAgB,EAChB,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CACjD,CAAC;gBAEF,kBAAkB;gBAClB,IAAI,CAAC,YAAY,CAAC,GAAG,CACjB,gBAAgB,EAChB,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,EAC9C,IAAI,CAAC,SAAS,CACjB,CAAC;gBAEF,IAAI,CAAC,eAAe,EAAE,CAAC;gBAEvB,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBAE7B,IAAI,CAAC,aAAa,EAAE,CAAC;gBAErB,OAAM;aACT;YAED,kCAAkC;YAClC,EAAE;YACF,oEAAoE;YACpE,sDAAsD;YACtD,8BAA8B;YAG9B,uBAAuB;YACvB,IAAI,aAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,aAAK,CAAC,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE;gBAEjI,IAAI,CAAC,MAAM,CAAC,iBAAiB,CACzB,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAC7B,IAAI,CAAC,qBAAqB,CAAC,iBAAiB,EAAE,CACjD,CAAC;gBAEF,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE;oBAC7B,2BAA2B;iBAC9B;gBAED,IAAI,CAAC,iBAAiB,EAAE,CAAC;gBAEzB,IAAI,CAAC,uBAAuB,EAAE,CAAC;gBAE/B,IAAI,CAAC,aAAa,EAAE,CAAC;aACxB;QACL,CAAC;QAED,yCAAuB,GAAvB;YACI,IAAI,iBAAiB,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,IAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YACzN,IAAI,iBAAiB,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,CAAC,GAAC,CAAC,IAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7N,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,iBAAiB,EAAE,iBAAiB,CAAC,CAAC,CAAA;QAC5E,CAAC;QAED,uCAAqB,GAArB;YACI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAA;QAC5C,CAAC;QACL,cAAC;IAAD,CAAC,AAnlBD,IAmlBC;IAnlBY,eAAO,UAmlBnB,CAAA;AACL,CAAC,EA5mBgB,OAAO,GAAP,eAAO,KAAP,eAAO,QA4mBvB","sourcesContent":["import {note, note as n} from \"../note/note\";\nimport TreeModel = require(\"tree-model\");\nimport {algorithm} from \"./algorithm\";\nimport {history} from \"../history/history\";\nimport {target} from \"../target/target\";\nimport {segment} from \"../segment/segment\";\nimport {parse} from \"../parse/parse\";\nimport {message} from \"../message/messenger\";\nimport {song} from \"../song/song\";\nimport {clip} from \"../clip/clip\";\nimport {iterate} from \"./iterate\";\nimport {log} from \"../log/logger\";\nimport {window} from \"../render/window\";\nimport {utils} from \"../utils/utils\";\nimport {live} from \"../live/live\";\nconst _ = require('underscore');\nconst l = require('lodash');\n\nexport namespace trainer {\n\n    import HistoryUserInput = history.HistoryUserInput;\n    import TargetIterator = target.TargetIterator;\n    import Segment = segment.Segment;\n    import PARSE = algorithm.PARSE;\n    import DERIVE = algorithm.DERIVE;\n    import DETECT = algorithm.DETECT;\n    import PREDICT = algorithm.PREDICT;\n    import Subtarget = target.Subtarget;\n    import Target = target.Target;\n    import Messenger = message.Messenger;\n    import Song = song.Song;\n    import Clip = clip.Clip;\n    import SubtargetIterator = target.SubtargetIterator;\n    import StructParse = parse.StructParse;\n    import MatrixIterator = iterate.MatrixIterator;\n    import FactoryMatrixTargetIterator = iterate.FactoryMatrixTargetIterator;\n    import IteratorTrainFactory = iterate.IteratorTrainFactory;\n    import Note = note.Note;\n    import Logger = log.Logger;\n    import ClipDao = clip.ClipDao;\n    import LiveApiJs = live.LiveApiJs;\n\n    export class Trainer {\n\n        private window;\n        public algorithm; // TODO: type\n        public clip_user_input: Clip;\n        public clip_user_input_synchronous: Clip;\n        // private clip_target: Clip;\n        private notes_target: TreeModel.Node<Note>[];\n        private song;\n        private segments: Segment[];\n        private messenger: Messenger;\n\n        private struct_parse: StructParse;\n        public history_user_input: HistoryUserInput;\n\n        private counter_user_input: number;\n        private limit_user_input: number;\n        private limit_input_reached: boolean;\n\n        private segment_current: Segment;\n        private target_current: Target;\n        private subtarget_current: Subtarget;\n\n        private matrix_focus: TargetIterator[][];\n        public iterator_matrix_train: MatrixIterator;\n        private iterator_target_current: TargetIterator;\n        private iterator_subtarget_current: SubtargetIterator;\n\n        constructor(window, user_input_handler, algorithm, clip_user_input, clip_user_input_synchronous, notes_target, song, segments, messenger) {\n            this.window = window;\n            this.algorithm = algorithm;\n            this.clip_user_input = clip_user_input;\n            this.clip_user_input_synchronous = clip_user_input_synchronous;\n            this.notes_target = notes_target;\n            this.song = song;\n            this.segments = segments;\n            this.messenger = messenger;\n\n            this.iterator_matrix_train = IteratorTrainFactory.get_iterator_train(\n                this.algorithm,\n                this.segments\n            );\n\n            this.matrix_focus = FactoryMatrixTargetIterator.create_matrix_focus(\n                this.algorithm,\n                this.segments\n            );\n\n            this.history_user_input = new HistoryUserInput(\n                l.cloneDeep(this.matrix_focus)\n            );\n\n            this.window.initialize_clips(\n                this.algorithm,\n                this.segments\n            );\n\n            this.window.set_length_beats(\n                this.segments[this.segments.length - 1].beat_end\n            );\n\n            if (this.algorithm.b_targeted()) {\n                this.create_targets()\n            } else {\n                this.struct_parse = new StructParse(\n                    l.cloneDeep(this.matrix_focus)\n                );\n                this.initialize_struct_parse();\n            }\n        }\n\n        private initialize_struct_parse() {\n\n            let note_segment_last = this.segments[this.segments.length - 1].get_note();\n\n            let tree: TreeModel = new TreeModel();\n\n            let note_length_full = tree.parse(\n                {\n                    id: -1, // TODO: hashing scheme for clip id and beat start\n                    note: new n.Note(\n                        note_segment_last.model.note.pitch,\n                        this.segments[0].get_note().model.note.beat_start,\n                        (note_segment_last.model.note.beat_start + note_segment_last.model.note.beats_duration) - this.segments[0].get_note().model.note.beat_start,\n                        note_segment_last.model.note.velocity,\n                        note_segment_last.model.note.muted\n                    ),\n                    children: [\n\n                    ]\n                }\n            );\n\n            this.struct_parse.set_root(\n                note_length_full\n            );\n\n            if (this.algorithm.get_name() === DERIVE) {\n                this.struct_parse.coords_roots = [[-1]];\n            }\n\n            // TODO: make the root the length of the entire song\n\n            this.window.add_note_to_clip_root(\n                note_length_full\n            );\n\n            // set first layer, which are the various key center estimates\n\n            for (let i_segment in this.segments) {\n\n                let segment = this.segments[Number(i_segment)];\n\n                // let logger = new Logger('max');\n                //\n                // logger.log(JSON.stringify(segment));\n\n                let note = segment.get_note();\n\n                let coord_current_virtual = [0, Number(i_segment)];\n\n                switch (this.algorithm.get_name()) {\n                    case DERIVE: {\n                        this.struct_parse.add(\n                            [note],\n                            coord_current_virtual,\n                            this.algorithm\n                        );\n                        break;\n                    }\n                    case PARSE: {\n                        this.struct_parse.set_notes(\n                            [note],\n                            coord_current_virtual\n                        );\n                        break;\n                    }\n                }\n\n                this.window.add_notes_to_clip(\n                    [note],\n                    coord_current_virtual\n                );\n\n                this.history_user_input.add(\n                    [note],\n                    coord_current_virtual\n                );\n\n                this.stream_segment_bounds();\n            }\n\n            switch (this.algorithm.get_name()) {\n                case PARSE: {\n\n                    // let notes_within_segment = notes_clip.filter(\n                    //     node => node.model.note.beat_start >= segment.get_endpoints_loop()[0] && node.model.note.get_beat_end() <= segment.get_endpoints_loop()[1]\n                    // );\n\n                    // TODO: use 'filter'\n                    for (let i_segment in this.segments) {\n                        let segment = this.segments[Number(i_segment)];\n                        // let notes = this.clip_target.get_notes(\n                        //     segment.beat_start,\n                        //     0,\n                        //     segment.beat_end - segment.beat_start,\n                        //     128\n                        // );\n\n                        let notes = this.notes_target.filter(\n                            node => node.model.note.beat_start >= segment.get_endpoints_loop()[0] && node.model.note.get_beat_end() <= segment.get_endpoints_loop()[1]\n                        );\n\n                        let coord_current_virtual = [this.algorithm.get_depth() - 1, Number(i_segment)];\n\n                        this.struct_parse.set_notes(\n                            notes,\n                            coord_current_virtual\n                        );\n                        this.window.add_notes_to_clip(\n                            notes,\n                            coord_current_virtual\n                        )\n                    }\n                    break;\n                }\n                case DERIVE: {\n                    //  TODO: anything?\n                    break;\n                }\n                default: {\n                    throw ['algorithm of name', this.algorithm.get_name(), 'not supported'].join(' ')\n                }\n            }\n        }\n\n        // now we can assume we have a list instead of a matrix\n        private create_targets() {\n\n            // TODO: use 'filter' here\n            // this.clip_target.load_notes_within_markers();\n\n            for (let i_segment in this.segments) {\n                let segment = this.segments[Number(i_segment)];\n\n                let notes_in_segment = this.notes_target.filter(\n                    node => node.model.note.beat_start >= segment.get_endpoints_loop()[0] && node.model.note.get_beat_end() <= segment.get_endpoints_loop()[1]\n                );\n\n                let sequence_targets = this.algorithm.determine_targets(\n                    // this.clip_target.get_notes(\n                    //     this.segments[Number(i_segment)].beat_start,\n                    //     0,\n                    //     this.segments[Number(i_segment)].beat_end - this.segments[Number(i_segment)].beat_start,\n                    //     128\n                    // )\n                    notes_in_segment\n                );\n\n                for (let target of sequence_targets) {\n                    for (let subtarget of target) {\n\n                        let subtarget_processed = this.algorithm.postprocess_subtarget(\n                            subtarget\n                        );\n\n                        this.clip_user_input.remove_notes(\n                            subtarget_processed.model.note.beat_start,\n                            0,\n                            subtarget_processed.model.note.get_beat_end(),\n                            128\n                        );\n\n                        this.clip_user_input.set_notes(\n                            [subtarget_processed]\n                        )\n                    }\n                }\n\n                this.matrix_focus[0][Number(i_segment)] = TargetIterator.from_sequence_target(sequence_targets);\n            }\n\n\n        }\n\n        public clear_window() {\n            this.window.clear()\n        }\n\n        public render_window() {\n            let notes = [];\n            if (this.algorithm.b_targeted()) {\n                notes = this.target_current.iterator_subtarget.subtargets.map((subtarget) => {\n                    return subtarget.note\n                })\n            }\n            // } else {\n            //     // notes = [this.segment_current.get_note()]\n            //     notes = []\n            // }\n            this.window.render(\n                this.iterator_matrix_train,\n                notes,\n                this.algorithm,\n                this.struct_parse\n            )\n        }\n\n        public reset_user_input() {\n            if (_.contains([DETECT, PREDICT], this.algorithm.get_name())) {\n                let coords = this.iterator_matrix_train.get_coord_current();\n                let notes_last = this.matrix_focus[coords[0] - 1][coords[1]].get_notes();\n                this.clip_user_input.set_notes(\n                    notes_last\n                );\n            } else {\n                return\n            }\n        }\n\n        // private set_loop() {\n        //     let interval = this.segment_current.get_endpoints_loop();\n        //\n        //     this.clip_user_input.set_endpoints_loop(\n        //         interval[0],\n        //         interval[1]\n        //     )\n        // }\n\n        private advance_scene(first_time?: boolean) {\n            this.segment_current.scene.fire(true);\n\n            if (first_time) {\n                return\n            }\n\n            // clip user input synchronous\n            let list_path_current_s = this.clip_user_input_synchronous.get_path().split(' ');\n            let index_clipslot_current_s = list_path_current_s[list_path_current_s.length - 2];\n            let list_path_next_s = list_path_current_s;\n            list_path_next_s[list_path_next_s.length - 2] = index_clipslot_current_s + 1;\n\n            this.clip_user_input_synchronous = new Clip(\n                new ClipDao(\n                    new LiveApiJs(\n                        list_path_next_s.join(' ')\n                    ),\n                    new Messenger('max', 0)\n                )\n            );\n\n            // clip user input deferred\n            let list_path_current = this.clip_user_input.get_path().split(' ');\n            let index_clipslot_current = list_path_current[list_path_current.length - 2];\n            let list_path_next = list_path_current;\n            list_path_next[list_path_next.length - 2] = index_clipslot_current + 1;\n            let clip_user_input_next = new Clip(\n                new ClipDao(\n                    new LiveApiJs(\n                        list_path_next.join(' ')\n                    ),\n                    new Messenger('max', 0),\n                    true,\n                    'clip_user_input'\n                )\n            );\n            clip_user_input_next.set_path_deferlow('set_path_clip_user_input');\n\n            this.clip_user_input = clip_user_input_next;\n        }\n\n        public resume() {\n            this.algorithm.post_init()\n        }\n\n        public pause() {\n            this.algorithm.pre_terminate(this.song, this.clip_user_input)\n        }\n\n        public terminate() {\n            this.algorithm.pre_terminate(this.song, this.clip_user_input)\n        }\n\n        public init(virtual?: boolean) {\n            if (this.algorithm.b_targeted()) {\n                this.advance_subtarget();\n            } else {\n                this.advance_segment(true);\n            }\n            if (!virtual) {\n                this.algorithm.post_init(this.song, this.clip_user_input)\n\n            }\n        }\n\n        private advance_segment(first_time?: boolean) {\n\n            let obj_next_coord = this.iterator_matrix_train.next();\n\n            if (obj_next_coord.done) {\n                switch(this.algorithm.get_name()) {\n                    case PARSE: {\n\n                        // make connections with segments\n                        for (let i_segment in this.segments) {\n                            let segment = this.segments[Number(i_segment)];\n                            this.struct_parse.add(\n                                [segment.get_note()],\n                                [0, Number(i_segment)],\n                                this.algorithm\n                            );\n                        }\n\n                        // make connections with root\n                        this.struct_parse.add(\n                            [Note.from_note_renderable(this.struct_parse.get_root())],\n                            [-1],\n                            this.algorithm\n                        );\n                        break;\n                    }\n                    case DERIVE: {\n                        break;\n                    }\n                    default: {\n                        throw 'error advancing segment'\n                    }\n                }\n\n                this.algorithm.pre_terminate(this.song, this.clip_user_input);\n\n                return\n            }\n\n            let coord = obj_next_coord.value;\n\n            this.segment_current = this.segments[coord[1]];\n\n            // TODO: PLEASE put back in\n            this.advance_scene(first_time);\n        }\n\n        private advance_subtarget() {\n\n            let have_not_begun: boolean = (!this.iterator_matrix_train.b_started);\n\n            if (have_not_begun) {\n                this.iterator_matrix_train.next();\n\n                this.iterator_target_current = this.matrix_focus[0][0];\n\n                this.iterator_target_current.next();\n\n                this.target_current = this.iterator_target_current.current();\n\n                this.iterator_subtarget_current = this.target_current.iterator_subtarget;\n\n                this.iterator_subtarget_current.next();\n\n                this.subtarget_current = this.iterator_subtarget_current.current();\n\n                this.handle_boundary_change();\n\n                return\n            }\n\n            let notes_in_segment_at_time = this.notes_target.filter(\n                node => node.model.note.beat_start >= this.segment_current.get_endpoints_loop()[0] && node.model.note.get_beat_end() <= this.segment_current.get_endpoints_loop()[1]\n            );\n\n            let targets_at_time: Target[] = this.iterator_target_current.targets;\n\n            let coord_at_time: number[] = this.iterator_matrix_train.get_coord_current();\n\n            let obj_next_subtarget = this.iterator_subtarget_current.next();\n\n            if (obj_next_subtarget.done) {\n\n                let obj_next_target = this.iterator_target_current.next();\n\n                if (obj_next_target.done) {\n\n                    let obj_next_coord = this.iterator_matrix_train.next();\n\n                    // TODO: can we add all notes in segment for predict here?\n\n                    let notes_to_add_to_history = [];\n\n                    if (this.algorithm.get_name() === PREDICT) {\n                        notes_to_add_to_history = notes_in_segment_at_time\n                    } else {\n                        notes_to_add_to_history = targets_at_time\n                    }\n\n                    this.history_user_input.add(\n                        notes_to_add_to_history,\n                        coord_at_time\n                    );\n\n                    if (obj_next_coord.done) {\n                        // TODO: can we add all notes in segment for predict here?\n                        this.history_user_input.add(\n                            notes_to_add_to_history,\n                            coord_at_time\n                        );\n\n                        this.algorithm.pre_terminate();\n\n                        return\n                    }\n\n                    let coord_next = obj_next_coord.value;\n\n                    this.iterator_target_current = this.matrix_focus[coord_next[0]][coord_next[1]];\n\n                    this.handle_boundary_change();\n\n                    let obj_next_target_twice_nested = this.iterator_target_current.next();\n\n                    this.target_current = obj_next_target_twice_nested.value;\n\n                    let obj_next_subtarget_twice_nested = this.target_current.iterator_subtarget.next();\n\n                    this.subtarget_current = obj_next_subtarget_twice_nested.value;\n\n                    this.iterator_subtarget_current = this.target_current.iterator_subtarget;\n\n                    return\n                }\n\n                this.target_current = obj_next_target.value;\n\n                let obj_next_subtarget_once_nested = this.target_current.iterator_subtarget.next();\n\n                this.subtarget_current = obj_next_subtarget_once_nested.value;\n\n                this.iterator_subtarget_current = this.target_current.iterator_subtarget;\n\n                return\n            }\n\n            this.subtarget_current = obj_next_subtarget.value;\n        }\n\n        handle_boundary_change() {\n            this.segment_current = this.segments[this.iterator_matrix_train.get_coord_current()[1]];\n\n            // TODO: PLEASE put back in\n            this.advance_scene();\n\n            // if (this.algorithm.b_targeted()) {\n            this.stream_subtarget_bounds();\n            // } else {\n            //     this.stream_segment_bounds();\n            // }\n        }\n\n        accept_input(notes_input_user: TreeModel.Node<n.Note>[]) {\n\n            this.counter_user_input++;\n\n            if (this.counter_user_input >= this.limit_user_input) {\n                this.limit_input_reached = true\n            }\n\n            if (this.limit_input_reached) {\n                // completely ignore\n                return\n            }\n\n            // parse/derive logic\n            if (!this.algorithm.b_targeted()) {\n\n                this.history_user_input.add(\n                    notes_input_user,\n                    this.iterator_matrix_train.get_coord_current()\n                );\n\n                this.window.add_notes_to_clip(\n                    notes_input_user,\n                    this.iterator_matrix_train.get_coord_current()\n                );\n\n                // TODO: implement\n                this.struct_parse.add(\n                    notes_input_user,\n                    this.iterator_matrix_train.get_coord_current(),\n                    this.algorithm\n                );\n\n                this.advance_segment();\n\n                this.stream_segment_bounds();\n\n                this.render_window();\n\n                return\n            }\n\n            // let logger = new Logger('max');\n            //\n            // logger.log(JSON.stringify(notes_input_user[0].model.note.pitch));\n            // logger.log(JSON.stringify(this.subtarget_current));\n            // logger.log('------------');\n\n\n            // detect/predict logic\n            if (utils.remainder(notes_input_user[0].model.note.pitch, 12) === utils.remainder(this.subtarget_current.note.model.note.pitch, 12)) {\n\n                this.window.add_notes_to_clip(\n                    [this.subtarget_current.note],\n                    this.iterator_matrix_train.get_coord_current()\n                );\n\n                if (this.algorithm.b_targeted()) {\n                    // set the targets and shit\n                }\n\n                this.advance_subtarget();\n\n                this.stream_subtarget_bounds();\n\n                this.render_window();\n            }\n        }\n\n        stream_subtarget_bounds() {\n            let ratio_bound_lower = (this.subtarget_current.note.model.note.beat_start - this.segment_current.get_endpoints_loop()[0])/(this.segment_current.get_endpoints_loop()[1] - this.segment_current.get_endpoints_loop()[0]);\n            let ratio_bound_upper = (this.subtarget_current.note.model.note.get_beat_end() - this.segment_current.get_endpoints_loop()[0])/(this.segment_current.get_endpoints_loop()[1] - this.segment_current.get_endpoints_loop()[0]);\n            this.messenger.message(['bounds', ratio_bound_lower, ratio_bound_upper])\n        }\n\n        stream_segment_bounds() {\n            this.messenger.message(['bounds', 0, 1])\n        }\n    }\n}"]}